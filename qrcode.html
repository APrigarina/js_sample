<html>
<head>
<meta charset="utf-8">
<title>Hello OpenCV.js</title>
</head>
<body>
<h2>QRCode OpenCV.js</h2>
<p id="status">OpenCV.js is loading...</p> 
<input type="button" id="run"  onclick="qrDetect()" value="Run" disabled=true />
<img id="imageSrc" src="qr_img.png"/> 
<canvas id="canvasOutput" ></canvas> 

<script>

    function qrDetect() {
      let src = cv.imread('imageSrc');
      let points = new cv.Mat();
      let qrCodeDetect = new cv.QRCodeDetector();
      qrCodeDetect.detect(src, points);

      for (let i = 0; i < 8; i+=2) {
        cv.line(src, new cv.Point(points.data32F[i%8], points.data32F[(i+1)%8]), 
                     new cv.Point(points.data32F[(i+2)%8], points.data32F[(i+3)%8]),
                     new cv.Scalar(0, 0, 255, 255), 5);
      }

      cv.imshow('canvasOutput',src);
      src.delete(); 
    }
  
  function onOpenCvReady() {
    document.getElementById('status').innerHTML = 'OpenCV.js is load.';
    cv["onRuntimeInitialized"]=()=> {
       document.getElementById("run").disabled=false;
  }
  }
</script>
<script async src="opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
</body>
</html>